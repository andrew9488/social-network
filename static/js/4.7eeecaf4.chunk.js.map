{"version":3,"sources":["components/Dialogs/Dialogs.module.css","components/Dialogs/DialogsItem/Dialog.module.css","components/Dialogs/DialogsItem/Message.module.css","components/Dialogs/Chat/Chat.module.css","components/Dialogs/DialogsItem/Dialog.tsx","components/Dialogs/DialogsItem/DialogContainer.tsx","components/Dialogs/DialogsItem/Message.tsx","components/Dialogs/DialogsItem/MessageContainer.tsx","components/Dialogs/Chat/Chat.tsx","components/Dialogs/Dialogs.tsx"],"names":["module","exports","Dialog","React","memo","props","className","style","dialog","dialogs","map","d","dialogItemContainer","to","PATH","DIALOGS","id","activeClassName","activeLink","dialogItem","src","img","alt","name","CHAT","photo","compose","connect","state","dialogsPage","withAuthRedirect","Message","dispatch","useDispatch","sendMessageText","useCallback","text","sendMessage","newText","reset","message","messageText","messages","m","CommonForm","onSubmit","Chat","useState","wsChannel","setWsChannel","setMessages","status","setStatus","messagesEndRef","useRef","useEffect","ws","closeWebSocket","setTimeout","openWebSocket","removeEventListener","close","WebSocket","addEventListener","messageHandler","e","newMessages","JSON","parse","data","prevState","statusHandler","sendChatMessage","send","current","scrollIntoView","behavior","chatContainer","chatBlock","mes","index","userId","ref","disable","ChatMessages","width","userName","Dialogs","history","useHistory","DialogContainer","location","pathname","MessageContainer"],"mappings":"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","file":"static/js/4.7eeecaf4.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogs\":\"Dialogs_dialogs__FhxYh\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialog\":\"Dialog_dialog__vfZZh\",\"dialogItemContainer\":\"Dialog_dialogItemContainer__3oAht\",\"activeLink\":\"Dialog_activeLink__3wrI0\",\"dialogItem\":\"Dialog_dialogItem__3A0vj\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"message\":\"Message_message__NMOAK\",\"messageText\":\"Message_messageText__215RR\",\"sendMessageButton\":\"Message_sendMessageButton__2mVJZ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chatContainer\":\"Chat_chatContainer__1trV7\",\"chatBlock\":\"Chat_chatBlock__1bCO1\"};","import style from \"./Dialog.module.css\";\r\nimport {NavLink} from \"react-router-dom\";\r\nimport React from \"react\";\r\nimport {DialogPropsType} from \"./DialogContainer\";\r\nimport {PATH} from \"../../Routes/Routes\";\r\nimport photo from \"./../../../assets/images/avatars/city-Z.png\";\r\n\r\nexport const Dialog: React.FC<DialogPropsType> = React.memo((props) => {\r\n\r\n    return (\r\n        <div className={style.dialog}>\r\n            {props.dialogs.map(d => <div className={style.dialogItemContainer} key={d.id}>\r\n                <NavLink to={`${PATH.DIALOGS}/${d.id}`} activeClassName={style.activeLink}>\r\n                    <div className={style.dialogItem}>\r\n                        <img src={d.img} alt=\"avatar\"/>\r\n                        <span>{d.name}</span>\r\n                    </div>\r\n                </NavLink>\r\n            </div>)}\r\n            <div className={style.dialogItemContainer}>\r\n                <NavLink to={`${PATH.DIALOGS}${PATH.CHAT}`} activeClassName={style.activeLink}>\r\n                    <div className={style.dialogItem}>\r\n                        <img src={photo} alt=\"city-Z\"/>\r\n                        <span>Polesye National Republic</span>\r\n                    </div>\r\n                </NavLink>\r\n            </div>\r\n        </div>\r\n    );\r\n})\r\n","import {Dialog} from \"./Dialog\";\r\nimport {connect} from \"react-redux\";\r\nimport {AppStateType} from \"../../../redux/redux-store\";\r\nimport {DialogType} from \"../../../redux/dialogsPageReducer\";\r\nimport {withAuthRedirect} from \"../../../hoc/withAuthRedirect\";\r\nimport {compose} from \"redux\";\r\nimport { ComponentType } from \"react\";\r\n\r\ntype MapStatePropsType = {\r\n    dialogs: Array<DialogType>\r\n}\r\n\r\ntype MapDispatchPropsType = {}\r\n\r\nexport type DialogPropsType = MapStatePropsType & MapDispatchPropsType\r\n\r\nconst mapStateToProps = (state: AppStateType): MapStatePropsType => {\r\n    return {\r\n        dialogs: state.dialogsPage.dialogs,\r\n    }\r\n}\r\n\r\n\r\nexport default compose<ComponentType>(\r\n    connect<MapStatePropsType, MapDispatchPropsType, {}, AppStateType>(mapStateToProps, {}),\r\n    withAuthRedirect)(Dialog)\r\n","import style from \"./Message.module.css\";\r\nimport React, {useCallback} from \"react\";\r\nimport {MessagePropsType} from \"./MessageContainer\";\r\nimport {CommonForm, CommonFormPropsType} from \"../../common/Form/CommonForm\";\r\nimport {reset} from \"redux-form\";\r\nimport {useDispatch} from \"react-redux\";\r\n\r\nexport const Message: React.FC<MessagePropsType> = React.memo((props) => {\r\n\r\n    const dispatch = useDispatch()\r\n\r\n    const sendMessageText = useCallback((text: CommonFormPropsType) => {\r\n        props.sendMessage(text.newText)\r\n        dispatch(reset(\"formForSendNewText\"))\r\n    }, [props])\r\n\r\n    return (\r\n        <div className={style.message}>\r\n            <div className={style.messageText}>\r\n                {props.messages.map(m => <div key={m.id}>{m.message}</div>)}\r\n            </div>\r\n            <CommonForm onSubmit={sendMessageText}/>\r\n        </div>\r\n    );\r\n})","import {Message} from \"./Message\";\r\nimport {connect} from \"react-redux\";\r\nimport {AppStateType} from \"../../../redux/redux-store\";\r\nimport {DialogsPageReducerActionsType, MessageType, sendMessage,} from \"../../../redux/dialogsPageReducer\";\r\nimport {compose, Dispatch} from \"redux\";\r\nimport {withAuthRedirect} from \"../../../hoc/withAuthRedirect\";\r\nimport {ComponentType} from \"react\";\r\n\r\ntype MapStatePropsType = {\r\n    messages: Array<MessageType>\r\n}\r\n\r\ntype MapDispatchPropsType = {\r\n    sendMessage: (text: string) => void\r\n}\r\n\r\nexport type MessagePropsType = MapStatePropsType & MapDispatchPropsType\r\n\r\nconst mapStateToProps = (state: AppStateType): MapStatePropsType => {\r\n    return {\r\n        messages: state.dialogsPage.messages,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Dispatch<DialogsPageReducerActionsType>): MapDispatchPropsType => {\r\n    return {\r\n        sendMessage: (text: string) => {\r\n            dispatch(sendMessage(text))\r\n        },\r\n    }\r\n}\r\n\r\nexport default compose<ComponentType>(\r\n    connect<MapStatePropsType, MapDispatchPropsType, {}, AppStateType>(mapStateToProps, mapDispatchToProps),\r\n    withAuthRedirect)(Message)\r\n","import React, {useCallback, useEffect, useRef, useState} from \"react\";\r\nimport {CommonForm, CommonFormPropsType} from \"../../common/Form/CommonForm\";\r\nimport style from \"./Chat.module.css\"\r\nimport {useDispatch} from \"react-redux\";\r\nimport {reset} from \"redux-form\";\r\n\r\ntype ChatMessageType = {\r\n    message: string\r\n    photo: string\r\n    userId: number\r\n    userName: string\r\n}\r\n\r\ntype StatusType = \"pending\" | \"ready\"\r\n\r\nexport const Chat: React.FC = React.memo(() => {\r\n\r\n    const [wsChannel, setWsChannel] = useState<WebSocket | null>(null)\r\n    const [messages, setMessages] = useState<Array<ChatMessageType>>([])\r\n    const [status, setStatus] = useState<StatusType>(\"pending\")\r\n    const messagesEndRef = useRef<null | HTMLDivElement>(null)\r\n    const dispatch = useDispatch()\r\n\r\n    useEffect(() => {\r\n        let ws: WebSocket\r\n        const closeWebSocket = () => {\r\n            setTimeout(openWebSocket, 3000)\r\n        }\r\n\r\n        function openWebSocket() {\r\n            ws?.removeEventListener(\"close\", closeWebSocket)\r\n            ws?.close()\r\n            ws = new WebSocket(\"wss://social-network.samuraijs.com/handlers/ChatHandler.ashx\")\r\n            ws.addEventListener(\"close\", closeWebSocket)\r\n            setWsChannel(ws)\r\n        }\r\n\r\n        openWebSocket()\r\n        return () => {\r\n            ws.removeEventListener(\"close\", closeWebSocket)\r\n            ws.close()\r\n        }\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        const messageHandler = (e: MessageEvent) => {\r\n            const newMessages = JSON.parse(e.data)\r\n            setMessages((prevState => [...prevState, ...newMessages]))\r\n        }\r\n        wsChannel?.addEventListener(\"message\", messageHandler)\r\n        return () => {\r\n            wsChannel?.removeEventListener(\"message\", messageHandler)\r\n        }\r\n    }, [wsChannel])\r\n\r\n    useEffect(() => {\r\n        const statusHandler = () => {\r\n            setStatus(\"ready\")\r\n        }\r\n        wsChannel?.addEventListener(\"open\", statusHandler)\r\n        return () => {\r\n            wsChannel?.removeEventListener(\"open\", statusHandler)\r\n        }\r\n    }, [wsChannel])\r\n\r\n    const sendChatMessage = useCallback((text: CommonFormPropsType) => {\r\n        wsChannel?.send(text.newText)\r\n        dispatch(reset(\"formForSendNewText\"))\r\n    }, [wsChannel])\r\n\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({behavior: 'smooth'});\r\n    }, [messages])\r\n\r\n\r\n    return (\r\n        <div className={style.chatContainer}>\r\n            <div className={style.chatBlock}>\r\n                {messages.map((mes, index) => {\r\n                    return <ChatMessages key={index + mes.userId} message={mes}/>\r\n                })}\r\n                <div ref={messagesEndRef}/>\r\n            </div>\r\n            <CommonForm disable={wsChannel === null || status !== \"ready\"} onSubmit={sendChatMessage}/>\r\n        </div>\r\n    );\r\n})\r\n\r\nconst ChatMessages: React.FC<{ message: ChatMessageType }> = ({message}) => {\r\n\r\n    return (\r\n        <div>\r\n            <img src={message.photo} alt=\"userPhoto\" style={{width: \"30px\"}}/> <b>{message.userName}</b>\r\n            <br/>\r\n            {message.message}\r\n            <hr/>\r\n        </div>\r\n    );\r\n}","import React from \"react\";\r\nimport style from \"./Dialogs.module.css\";\r\nimport DialogContainer from \"./DialogsItem/DialogContainer\";\r\nimport MessageContainer from \"./DialogsItem/MessageContainer\";\r\nimport {PATH} from \"../Routes/Routes\";\r\nimport {useHistory} from \"react-router-dom\";\r\nimport {Chat} from \"./Chat/Chat\";\r\n\r\nconst Dialogs: React.FC = React.memo(() => {\r\n\r\n    const history = useHistory()\r\n    return (\r\n        <div className={style.dialogs}>\r\n            <div>\r\n                <DialogContainer/>\r\n            </div>\r\n            {history.location.pathname === `${PATH.DIALOGS}${PATH.CHAT}`\r\n                ? <Chat/>\r\n                : <MessageContainer/>}\r\n        </div>\r\n    );\r\n})\r\n\r\nexport default Dialogs;"],"sourceRoot":""}